<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Trading Information</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <h1>Live Stock Information</h1>

    <div id="stockChart" style="width: 800px; height: 400px;"></div>

    <script>
        const apiKey = "S5XWQMZ8L2XBQTIS"; // Replace with your Alpha Vantage API key
        const chartDom = document.getElementById('stockChart');
        const stockChart = echarts.init(chartDom);
        const symbol = "AMZN"; // Only using AMZN for testing
        const stockData = [];

        const option = {
            title: {
                text: 'Stock Prices Over Time'
            },
            tooltip: {
                trigger: 'axis'
            },
            xAxis: {
                type: 'time',
                boundaryGap: false
            },
            yAxis: {
                type: 'value',
                axisLabel: {
                    formatter: '${value}'
                },
                min: function (value) {
                    return value.min * 0.95; // Smaller intervals for better differences visualization
                },
                max: function (value) {
                    return value.max * 1.05;
                }
            },
            series: [
                {
                    name: symbol,
                    type: 'line',
                    data: stockData,
                    smooth: true,
                    symbol: 'none'
                }
            ]
        };

        stockChart.setOption(option);

        async function fetchStockPrices() {
            try {
                const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${apiKey}`);
                const data = await response.json();
                const timeSeries = data["Time Series (5min)"];
                if (timeSeries) {
                    stockData.length = 0; // Clear existing data
                    Object.keys(timeSeries).reverse().forEach(timeKey => {
                        const price = parseFloat(timeSeries[timeKey]["4. close"]);
                        const time = new Date(timeKey);
                        stockData.push([time, price]);
                    });
                }
            } catch (error) {
                console.error("Error fetching stock price:", error);
            }
            stockChart.setOption({
                series: [
                    {
                        name: symbol,
                        type: 'line',
                        data: stockData,
                        smooth: true,
                        symbol: 'none'
                    }
                ]
            });
        }

        // Fetch and update stock prices every 5 minutes
        fetchStockPrices();
        setInterval(fetchStockPrices, 300000);
    </script>

</body>
</html>